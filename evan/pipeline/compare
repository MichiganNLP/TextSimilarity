#!/usr/bin/env bash
set -e

status_message() {
  echo -en '\033[35m'
  echo "$1"
  echo -en '\033[0m'
}

status_message 'Creating output directory'
output="$(./libexec/make_output_directory.sh)"

status_message 'Creating Python virtual environment with packages'
output="$output" ./libexec/make_virtualenv.sh

status_message 'Reformatting sentences'
filename="$1" ./libexec/untab_sentences.sh > "$output/untabbed.txt"

status_message 'Running through OpenIE'
input="$output/untabbed.txt" output="$output/openie_output.txt" ./libexec/get_openie_output.sh

status_message 'Parsing OpenIE output to get permutations'
./libexec/parse_openie.py "$output"

status_message 'Running permutations through Semafor'
output="$output" ./libexec/get_semafor_output.sh

status_message 'Finding best Semafor permutations'
./libexec/find_best_semafor_permutations.py "$output/semafor_output.xml"

status_message 'Deactivating Python virtual environment'
deactivate
